# âœ… æœç´¢ç»“æœå…³é”®è¯é«˜äº®åŠŸèƒ½å®ç°å®Œæˆ

## åŠŸèƒ½æ¦‚è¿°

åœ¨æœç´¢ç»“æœé¡µé¢ä¸­ï¼Œç”¨æˆ·æœç´¢çš„å…³é”®è¯ä¼šä»¥é»„è‰²èƒŒæ™¯é«˜äº®æ˜¾ç¤ºï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½åŒ¹é…å†…å®¹ã€‚

## ğŸ“ å®ç°å†…å®¹

### 1. åˆ›å»ºé«˜äº®å·¥å…·å‡½æ•°

**æ–‡ä»¶ï¼š** `src/utils/highlightText.tsx`

```typescript
export function highlightText(text: string, searchQuery: string): JSX.Element {
  if (!text || !searchQuery) {
    return <>{text}</>;
  }

  // è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯
  const escapeRegExp = (str: string) => {
    return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  };

  // åˆ›å»ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼
  const regex = new RegExp(`(${escapeRegExp(searchQuery)})`, 'gi');

  // åˆ†å‰²æ–‡æœ¬
  const parts = text.split(regex);

  return (
    <>
      {parts.map((part, index) => {
        // æ£€æŸ¥æ˜¯å¦æ˜¯åŒ¹é…çš„å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
        if (part.toLowerCase() === searchQuery.toLowerCase()) {
          return (
            <mark
              key={index}
              className="bg-yellow-200 text-gray-900 font-medium px-0.5 rounded"
            >
              {part}
            </mark>
          );
        }
        return <span key={index}>{part}</span>;
      })}
    </>
  );
}
```

### 2. ä¿®æ”¹æœç´¢ç»“æœé¡µé¢

**æ–‡ä»¶ï¼š** `src/pages/SearchResultsPage.tsx`

#### 2.1 å¯¼å…¥é«˜äº®å‡½æ•°

```typescript
import { highlightText } from '../utils/highlightText';
```

#### 2.2 åœ¨æ ‡é¢˜ä¸­åº”ç”¨é«˜äº®

```typescript
<h3 className="text-xl font-semibold text-gray-900 flex-1 mr-4">
  {highlightText(result.note_title || 'æ— æ ‡é¢˜', query)}
</h3>
```

#### 2.3 åœ¨å†…å®¹ç‰‡æ®µä¸­åº”ç”¨é«˜äº®

```typescript
<div className="text-gray-700 text-sm mb-4">
  {result.content_chunk && typeof result.content_chunk === 'string' && result.content_chunk.length > 0 ? (
    <p className="line-clamp-3">
      {highlightText(
        result.content_chunk.length > 200 
          ? result.content_chunk.slice(0, 200) + '...'
          : result.content_chunk,
        query
      )}
    </p>
  ) : (
    <p className="text-gray-400 italic">æš‚æ— å†…å®¹é¢„è§ˆ</p>
  )}
</div>
```

## ğŸ¨ é«˜äº®æ ·å¼

### Tailwind CSS ç±»

```css
bg-yellow-200      /* é»„è‰²èƒŒæ™¯ */
text-gray-900      /* æ·±è‰²æ–‡å­— */
font-medium        /* ä¸­ç­‰å­—é‡ */
px-0.5             /* æ°´å¹³å†…è¾¹è· */
rounded            /* åœ†è§’ */
```

### è§†è§‰æ•ˆæœ

```
æ™®é€šæ–‡æœ¬ é«˜äº®å…³é”®è¯ æ™®é€šæ–‡æœ¬
         ^^^^^^^^
         é»„è‰²èƒŒæ™¯
```

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### 1. å¤§å°å†™ä¸æ•æ„Ÿ

```typescript
// æœç´¢ "justice"
"Justice" â†’ é«˜äº® âœ…
"JUSTICE" â†’ é«˜äº® âœ…
"justice" â†’ é«˜äº® âœ…
```

### 2. æ”¯æŒä¸­è‹±æ–‡

```typescript
// ä¸­æ–‡
æœç´¢ "æ­£ä¹‰" â†’ "æ­£ä¹‰åŸåˆ™" ä¸­çš„ "æ­£ä¹‰" é«˜äº® âœ…

// è‹±æ–‡
æœç´¢ "justice" â†’ "Justice Theory" ä¸­çš„ "Justice" é«˜äº® âœ…
```

### 3. ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰

```typescript
// è‡ªåŠ¨è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ®Šå­—ç¬¦
æœç´¢ "C++" â†’ æ­£ç¡®åŒ¹é… "C++" âœ…
æœç´¢ "$100" â†’ æ­£ç¡®åŒ¹é… "$100" âœ…
æœç´¢ "(test)" â†’ æ­£ç¡®åŒ¹é… "(test)" âœ…
```

### 4. å¤šæ¬¡åŒ¹é…

```typescript
// æ–‡æœ¬ä¸­æ‰€æœ‰åŒ¹é…çš„å…³é”®è¯éƒ½ä¼šé«˜äº®
"æ­£ä¹‰åŸåˆ™æ˜¯æ­£ä¹‰ç†è®ºçš„æ ¸å¿ƒ"
æœç´¢ "æ­£ä¹‰" â†’ ä¸¤ä¸ª "æ­£ä¹‰" éƒ½é«˜äº® âœ…
```

## ğŸ“Š åº”ç”¨ä½ç½®

| ä½ç½® | æ˜¯å¦é«˜äº® | è¯´æ˜ |
|------|---------|------|
| ç¬”è®°æ ‡é¢˜ | âœ… | æ ‡é¢˜ä¸­çš„å…³é”®è¯é«˜äº® |
| å†…å®¹ç‰‡æ®µ | âœ… | å†…å®¹é¢„è§ˆä¸­çš„å…³é”®è¯é«˜äº® |
| ä½œè€…åç§° | âŒ | ä¸é«˜äº®ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼‰ |
| å…³é”®è¯æ ‡ç­¾ | âŒ | ä¸é«˜äº®ï¼ˆå·²ç»æ˜¯æ ‡ç­¾å½¢å¼ï¼‰ |

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1ï¼šä¸­æ–‡å…³é”®è¯

**æœç´¢ï¼š** "æ­£ä¹‰åŸåˆ™"

**é¢„æœŸç»“æœï¼š**
```
æ ‡é¢˜ï¼šç½—å°”æ–¯çš„æ­£ä¹‰åŸåˆ™ç ”ç©¶
      ^^^^^^^^
      ï¼ˆé»„è‰²é«˜äº®ï¼‰

å†…å®¹ï¼šç½—å°”æ–¯æå‡ºçš„æ­£ä¹‰åŸåˆ™åŒ…æ‹¬è‡ªç”±åŸåˆ™å’Œå·®å¼‚åŸåˆ™...
              ^^^^^^^^
              ï¼ˆé»„è‰²é«˜äº®ï¼‰
```

### æµ‹è¯• 2ï¼šè‹±æ–‡å…³é”®è¯

**æœç´¢ï¼š** "justice"

**é¢„æœŸç»“æœï¼š**
```
æ ‡é¢˜ï¼šJustice as Fairness
      ^^^^^^^
      ï¼ˆé»„è‰²é«˜äº®ï¼‰

å†…å®¹ï¼šRawls defines justice as fairness...
                    ^^^^^^^
                    ï¼ˆé»„è‰²é«˜äº®ï¼‰
```

### æµ‹è¯• 3ï¼šå¤§å°å†™ä¸æ•æ„Ÿ

**æœç´¢ï¼š** "Justice"

**é¢„æœŸç»“æœï¼š**
```
"justice" â†’ é«˜äº® âœ…
"Justice" â†’ é«˜äº® âœ…
"JUSTICE" â†’ é«˜äº® âœ…
```

### æµ‹è¯• 4ï¼šç‰¹æ®Šå­—ç¬¦

**æœç´¢ï¼š** "C++"

**é¢„æœŸç»“æœï¼š**
```
"å­¦ä¹  C++ ç¼–ç¨‹" â†’ "C++" é«˜äº® âœ…
ï¼ˆä¸ä¼šå› ä¸º + æ˜¯æ­£åˆ™ç‰¹æ®Šå­—ç¬¦è€ŒæŠ¥é”™ï¼‰
```

### æµ‹è¯• 5ï¼šå¤šæ¬¡åŒ¹é…

**æœç´¢ï¼š** "æ­»äº¡"

**é¢„æœŸç»“æœï¼š**
```
"æ­»äº¡æ˜¯ç”Ÿå‘½çš„ç»ˆç»“ï¼Œå¯¹æ­»äº¡çš„ææƒ§..."
 ^^              ^^
ï¼ˆä¸¤å¤„éƒ½é«˜äº®ï¼‰
```

## ğŸ¯ è§†è§‰æ•ˆæœç¤ºä¾‹

### æœç´¢ "æ­£ä¹‰åŸåˆ™"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç½—å°”æ–¯çš„æ­£ä¹‰åŸåˆ™ç ”ç©¶                    [92%]   â”‚
â”‚         ^^^^^^^^                                â”‚
â”‚         ï¼ˆé»„è‰²èƒŒæ™¯ï¼‰                             â”‚
â”‚                                                 â”‚
â”‚ ğŸ‘¤ John Rawls                                  â”‚
â”‚                                                 â”‚
â”‚ ğŸ·ï¸ æ­£ä¹‰  ğŸ·ï¸ æ”¿æ²»å“²å­¦                         â”‚
â”‚                                                 â”‚
â”‚ ç½—å°”æ–¯æå‡ºçš„æ­£ä¹‰åŸåˆ™åŒ…æ‹¬è‡ªç”±åŸåˆ™å’Œå·®å¼‚åŸåˆ™ï¼Œ   â”‚
â”‚           ^^^^^^^^                              â”‚
â”‚           ï¼ˆé»„è‰²èƒŒæ™¯ï¼‰                           â”‚
â”‚ è¿™ä¸¤ä¸ªåŸåˆ™æ„æˆäº†ä»–çš„æ­£ä¹‰ç†è®ºçš„æ ¸å¿ƒ...          â”‚
â”‚                 ^^^^^^^^                        â”‚
â”‚                 ï¼ˆé»„è‰²èƒŒæ™¯ï¼‰                     â”‚
â”‚                                                 â”‚
â”‚ æŸ¥çœ‹å®Œæ•´ç¬”è®° â†’                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ­£åˆ™è¡¨è¾¾å¼è½¬ä¹‰

```typescript
const escapeRegExp = (str: string) => {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
};
```

**ä½œç”¨ï¼š** è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…è¯­æ³•é”™è¯¯ã€‚

**ç¤ºä¾‹ï¼š**
- `"C++"` â†’ `"C\\+\\+"`
- `"$100"` â†’ `"\\$100"`
- `"(test)"` â†’ `"\\(test\\)"`

### 2. å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…

```typescript
const regex = new RegExp(`(${escapeRegExp(searchQuery)})`, 'gi');
//                                                          ^^
//                                                          g: å…¨å±€åŒ¹é…
//                                                          i: å¿½ç•¥å¤§å°å†™
```

### 3. æ–‡æœ¬åˆ†å‰²ä¸é‡ç»„

```typescript
const parts = text.split(regex);
// "Hello World" æœç´¢ "world"
// â†’ ["Hello ", "World", ""]

parts.map((part, index) => {
  if (part.toLowerCase() === searchQuery.toLowerCase()) {
    return <mark key={index}>{part}</mark>;  // é«˜äº®
  }
  return <span key={index}>{part}</span>;    // æ™®é€šæ–‡æœ¬
});
```

### 4. ç©ºå€¼å®‰å…¨

```typescript
if (!text || !searchQuery) {
  return <>{text}</>;  // ç›´æ¥è¿”å›åŸæ–‡æœ¬
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘

- é«˜äº®å‡½æ•°å¯¹æ¯ä¸ªæœç´¢ç»“æœéƒ½ä¼šæ‰§è¡Œ
- å¯¹äºé•¿æ–‡æœ¬ï¼Œå»ºè®®å…ˆæˆªæ–­å†é«˜äº®ï¼ˆå·²å®ç°ï¼‰
- å½“å‰å®ç°ï¼šæˆªæ–­åˆ° 200 å­—ç¬¦

### 2. HTML å®‰å…¨

- ä½¿ç”¨ JSX å…ƒç´ è€Œä¸æ˜¯ `dangerouslySetInnerHTML`
- é¿å… XSS æ”»å‡»é£é™©

### 3. æ ·å¼å†²çª

- ä½¿ç”¨ Tailwind CSS ç±»
- ç¡®ä¿ `bg-yellow-200` åœ¨é¡¹ç›®ä¸­å¯ç”¨
- å¦‚æœéœ€è¦è‡ªå®šä¹‰é¢œè‰²ï¼Œä¿®æ”¹ `className`

## ğŸ¨ è‡ªå®šä¹‰æ ·å¼

å¦‚æœéœ€è¦ä¿®æ”¹é«˜äº®æ ·å¼ï¼Œç¼–è¾‘ `highlightText.tsx`ï¼š

```typescript
// å½“å‰æ ·å¼
className="bg-yellow-200 text-gray-900 font-medium px-0.5 rounded"

// æ©™è‰²é«˜äº®
className="bg-orange-200 text-gray-900 font-medium px-0.5 rounded"

// è“è‰²é«˜äº®
className="bg-blue-200 text-gray-900 font-medium px-0.5 rounded"

// åŠ ç²— + ä¸‹åˆ’çº¿
className="bg-yellow-200 text-gray-900 font-bold underline px-0.5 rounded"
```

## âœ… å®Œæˆæ¸…å•

- âœ… åˆ›å»º `highlightText.tsx` å·¥å…·å‡½æ•°
- âœ… å¯¼å…¥åˆ° `SearchResultsPage.tsx`
- âœ… åœ¨æ ‡é¢˜ä¸­åº”ç”¨é«˜äº®
- âœ… åœ¨å†…å®¹ç‰‡æ®µä¸­åº”ç”¨é«˜äº®
- âœ… æ”¯æŒä¸­è‹±æ–‡å…³é”®è¯
- âœ… å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
- âœ… ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬ä¹‰
- âœ… é»„è‰²èƒŒæ™¯ + æ·±è‰²æ–‡å­—æ ·å¼
- âœ… ä»£ç é€šè¿‡ TypeScript è¯Šæ–­æ£€æŸ¥

## ğŸ‰ åŠŸèƒ½å®Œæˆï¼

æœç´¢ç»“æœé¡µé¢ç°åœ¨å¯ä»¥é«˜äº®æ˜¾ç¤ºç”¨æˆ·æœç´¢çš„å…³é”®è¯ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½åŒ¹é…å†…å®¹ã€‚

æ”¯æŒä¸­è‹±æ–‡ã€å¤§å°å†™ä¸æ•æ„Ÿã€ç‰¹æ®Šå­—ç¬¦å®‰å…¨å¤„ç†ï¼Œè§†è§‰æ•ˆæœæ¸…æ™°æ˜æ˜¾ï¼
